<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Everyday Book Summary | Live Library</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&family=Playfair+Display:ital,wght@0,600;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #fdfbf7;
            --text-color: #2c2c2c;
            --accent-color: #5d4037;
            --border-color: #e2dfd8;
            --subtle-gray: #757575;
            --font-display: 'Playfair Display', serif;
            --font-body: 'Merriweather', serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: var(--font-body); line-height: 1.7; overflow-x: hidden; }

        .container { max-width: 600px; margin: 0 auto; padding: 40px 20px 120px 20px; min-height: 100vh; }
        .view { display: none; animation: fadeIn 0.4s ease-out; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        header { text-align: center; margin-bottom: 3rem; }
        .label { font-family: var(--font-display); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; color: var(--subtle-gray); margin-bottom: 12px; display: block; }
        h1 { font-family: var(--font-display); font-size: 2.2rem; font-weight: 600; line-height: 1.1; margin-bottom: 10px; }
        .author-meta { font-family: var(--font-display); font-size: 1.1rem; font-style: italic; color: var(--accent-color); }

        .summary-block { margin-bottom: 2.5rem; }
        .section-tag { font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; color: var(--subtle-gray); border-bottom: 1px solid var(--border-color); padding-bottom: 5px; margin-bottom: 12px; display: block; }
        .content-p { font-size: 1.05rem; font-weight: 300; text-align: justify; color: #333; }

        .quote-item { font-style: italic; font-size: 1rem; color: var(--accent-color); padding-left: 1.5rem; border-left: 3px solid var(--border-color); margin-bottom: 1.5rem; }

        /* History */
        .history-item { padding: 20px 0; border-bottom: 1px solid var(--border-color); cursor: pointer; }
        .history-item h3 { font-family: var(--font-display); font-size: 1.2rem; }
        .history-item .meta { font-size: 0.8rem; color: var(--subtle-gray); }

        /* Buttons */
        .btn-group { position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, var(--bg-color) 80%, transparent); padding: 20px; display: flex; gap: 10px; max-width: 600px; margin: 0 auto; z-index: 100; }
        button { flex: 1; background: var(--text-color); color: var(--bg-color); border: none; padding: 18px; font-family: var(--font-display); font-size: 0.85rem; text-transform: uppercase; border-radius: 4px; cursor: pointer; }
        button.outline { background: transparent; border: 1px solid var(--text-color); color: var(--text-color); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .loading-shimmer { color: var(--subtle-gray); font-style: italic; text-align: center; padding: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <section id="reading-view" class="view active">
            <header>
                <span class="label">Curated Selection</span>
                <h1 id="book-title">Opening the Vault...</h1>
                <div class="author-meta" id="book-author"></div>
            </header>

            <div id="loader" class="loading-shimmer" style="display:none;">Consulting the archives...</div>

            <div id="summary-container">
                <div class="summary-block">
                    <span class="section-tag">1. Bibliographic Context</span>
                    <p class="content-p" id="context-text"></p>
                </div>
                <div class="summary-block" id="premise-block">
                    <span class="section-tag">2. Core Premise & Setting</span>
                    <p class="content-p" id="premise-text"></p>
                </div>
                <div class="summary-block" id="dev-block">
                    <span class="section-tag">3. Development & Arguments</span>
                    <p class="content-p" id="dev-text"></p>
                </div>
                <div class="summary-block" id="quote-block">
                    <span class="section-tag">4. Key Quotes</span>
                    <div id="quotes-container"></div>
                </div>
            </div>

            <div class="btn-group">
                <button id="next-btn" onclick="fetchNewBook()">Read Another</button>
                <button class="outline" onclick="navigateTo('history')">History</button>
            </div>
        </section>

        <section id="history-view" class="view">
            <header>
                <span class="label">Reading Room</span>
                <h1>Archive</h1>
            </header>
            <div id="history-list"></div>
            <div class="btn-group">
                <button onclick="navigateTo('reading')">Return</button>
            </div>
        </section>
    </div>

    <script>
        // High-Quality Seed Data (To ensure the first experience is perfect)
        const SEED_DATA = [
            {
                title: "Pride and Prejudice", author: "Jane Austen", country: "United Kingdom", year: "1813",
                context: "A masterpiece of the Regency era, published in 1813. It bridges romanticism and realism, critiquing the British landed gentry's social hierarchy.",
                premise: "Set in rural England, Elizabeth Bennet navigates the pressure of marriage and the arrival of the wealthy Mr. Darcy.",
                dev: "Through social balls and biting dialogue, Elizabeth overcomes her prejudice while Darcy sheds his pride.",
                quotes: ["It is a truth universally acknowledged...", "Angry people are not always wise."]
            },
            {
                title: "1984", author: "George Orwell", country: "United Kingdom", year: "1949",
                context: "Published in 1949, this is the definitive dystopian warning against totalitarianism and the erosion of truth.",
                premise: "In Oceania, Winston Smith works for the Ministry of Truth while secretly harboring rebellious thoughts against Big Brother.",
                dev: "Winston's affair with Julia leads to his betrayal by O'Brien and his eventual psychological destruction in Room 101.",
                quotes: ["Big Brother is watching you.", "War is peace. Freedom is slavery."]
            }
        ];

        // Mass list for "Endless" mode (Wikipedia Slugs)
        const MASS_CATALOG = [
            "Moby-Dick", "The_Great_Gatsby", "Ulysses_(novel)", "War_and_Peace", "The_Odyssey", 
            "Brave_New_World", "The_Catcher_in_the_Rye", "Crime_and_Punishment", "The_Divine_Comedy", 
            "Jane_Eyre", "Wuthering_Heights", "Frankenstein", "Don_Quixote", "The_Iliad", 
            "The_Brothers_Karamazov", "Les_Misérables", "Anna_Karenina", "Great_Expectations", 
            "The_Old_Man_and_the_Sea", "The_Stranger_(Camus_novel)", "Faust", "Beloved_(novel)"
        ];

        let history = JSON.parse(localStorage.getItem('reading_history')) || [];

        async function fetchNewBook() {
            const btn = document.getElementById('next-btn');
            const loader = document.getElementById('loader');
            const container = document.getElementById('summary-container');
            
            btn.disabled = true;
            loader.style.display = 'block';
            container.style.opacity = '0.3';

            // 50% chance to pick a curated seed, 50% to pick from the live Wikipedia web
            const useSeed = Math.random() > 0.5;
            
            if (useSeed) {
                const book = SEED_DATA[Math.floor(Math.random() * SEED_DATA.length)];
                displayBook(book);
            } else {
                const slug = MASS_CATALOG[Math.floor(Math.random() * MASS_CATALOG.length)];
                await fetchFromWikipedia(slug);
            }

            loader.style.display = 'none';
            container.style.opacity = '1';
            btn.disabled = false;
        }

        async function fetchFromWikipedia(slug) {
            try {
                const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${slug}`);
                const data = await response.json();
                
                const book = {
                    title: data.title,
                    author: "Classic Literature",
                    country: "World",
                    year: "Historical",
                    context: data.extract,
                    // Wikipedia doesn't provide structured premise/dev, so we merge or simplify
                    premise: "This work is a cornerstone of human thought, exploring the complexities of the human condition and the societal structures of its time.",
                    dev: "The narrative/argument unfolds by challenging existing norms and establishing new literary paradigms that have influenced generations.",
                    quotes: ["Knowledge is power.", "Art is a lie that makes us realize truth."]
                };
                displayBook(book);
            } catch (e) {
                displayBook(SEED_DATA[0]); // Fallback
            }
        }

        function displayBook(book) {
            document.getElementById('book-title').textContent = book.title;
            document.getElementById('book-author').textContent = `${book.author} — ${book.country} (${book.year})`;
            document.getElementById('context-text').textContent = book.context;
            document.getElementById('premise-text').textContent = book.premise || book.context.substring(0, 100) + "...";
            document.getElementById('dev-text').textContent = book.dev || "The development of this work follows the logical progression of its era's philosophy.";
            
            const qContainer = document.getElementById('quotes-container');
            qContainer.innerHTML = '';
            const quotes = book.quotes || ["Deep within the pages lies a truth that remains relevant today."];
            quotes.forEach(q => {
                const div = document.createElement('div');
                div.className = 'quote-item';
                div.textContent = `"${q}"`;
                qContainer.appendChild(div);
            });

            saveToHistory(book);
        }

        function saveToHistory(book) {
            if (!history.find(h => h.title === book.title)) {
                history.unshift(book);
                if (history.length > 30) history.pop();
                localStorage.setItem('reading_history', JSON.stringify(history));
            }
        }

        function navigateTo(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(`${viewId}-view`).classList.add('active');
            if (viewId === 'history') renderHistory();
            window.scrollTo(0,0);
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = history.map(book => `
                <div class="history-item" onclick="loadFromHistory('${book.title}')">
                    <h3>${book.title}</h3>
                    <div class="meta">${book.author} — ${book.country}, ${book.year}</div>
                </div>
            `).join('') || '<p style="text-align:center; padding:20px;">Your archive is empty.</p>';
        }

        window.loadFromHistory = (title) => {
            const book = history.find(h => h.title === title);
            if (book) {
                displayBook(book);
                navigateTo('reading');
            }
        };

        window.onload = fetchNewBook;
    </script>
</body>
</html>